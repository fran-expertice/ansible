---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to 
# review and if you deem appropriate, deploy on your systems running Red Hat software. 
# Based on the analysis, we have automatically generated an Ansible Playbook for you. 
# Please review and test the recommended actions and the Playbook as they may contain 
# configuration changes, updates, reboots and/or other changes to your systems. Red Hat is 
# not responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# uno https://cloud.redhat.com/insights/remediations/e1b7cded-442a-4495-b26f-5f253d89b1dc 
# Generated by Red Hat Insights on Thu, 08 Aug 2019 00:21:30 GMT Kernel vulnerable to 
# remote denial of service via SACK packets (CVE-2019-11477, CVE-2019-11478, and 
# CVE-2019-11479) Identifier: 
# (advisor:CVE_2019_11477_kernel|CVE_2019_11477_KERNEL,mitigate) Version: 
# 47052ef82350f592c7fba5517c2e2ab321f15458
#
# TCP SACK PANIC Mitigation Playbook v1.0
#
# To completely address TCP SACK PANIC vulnerabilities, you will need to update your 
# kernel. However, if you are unable to reboot your system into a new kernel immediately, 
# disabling selective acknowledgments for the running system will reduce the system's 
# attack surface for this issue.
#
# This playbook will disable selective acknowledgments system wide for all newly 
# established TCP connections for the running system, create a file 
# /etc/sysctl.d/99-tcpsack.conf to disable selective acknowledgmentsat boot time. The 
# playbook will not reboot the system. A reboot is not necessary for mitigation.
#
# To verify the state of your system after rebooting, you can inspect the file located at 
# /proc/sys/net/ipv4/tcp_sack, or you can run the detection script available on the 
# "Diagnose" tab of the vulnerability article.
#
# To use this playbook, specify the host group or individual hostnames with the "HOSTS" 
# extra var:
#
#   ansible-playbook -e HOSTS=web,mail,ldap04 disable_tcpsack_mitigate.yml
#
# See https://access.redhat.com/security/vulnerabilities/tcpsack for more information.
#
- name: Disable selective acknowledgments for the running system
  hosts: 192.168.3.3
  become: true
  tasks:
   - name: Set net.ipv4.tpc_sack to 0
     sysctl:
       name: net.ipv4.tcp_sack
       value: '0'
       sysctl_set: yes
       state: present
       reload: yes
       sysctl_file: /etc/sysctl.d/99-tcpsack.conf 

- name: run insights
  hosts: 192.168.3.3
  become: True
  gather_facts: False
  tasks:
   - name: run insights
     command: insights-client
     changed_when: false
